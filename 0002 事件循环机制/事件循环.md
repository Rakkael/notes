---
title:"0002 事件循环机制"
output:pdf_document
---

>答题思路：
```
先说基本知识点，宏任务、微任务有哪些

说事件循环机制过程，边说边画图出来

说async/await执行顺序注意，可以把 chrome 的优化，做法其实是违反了规范的，V8 团队的PR这些自信点说出来，显得你很好学，理解得很详细，很透彻。

把node的事件循环也说一下，重复1、2、3点，node中的第3点要说的是node11前后的事件循环变动点。
```
>模拟提问

1、事件循环是什么？
------
```
官方解释：
javaScript代码的执行过程中，除了依靠函数调用栈来搞定函数的执行顺序外，还依靠任务队列(task queue)来搞定另外一些代码的执行。整个执行过程，我们称为事件循环过程。一个线程中，事件循环是唯一的，但是任务队列可以拥有多个。任务队列又分为macro-task（宏任务）与micro-task（微任务），在最新标准中，它们被分别称为task与jobs。

个人理解：
事件循环是单线程的js，为了能够执行异步任务而设计的事件执行顺序。

```

2、事件循环的过程是怎样的？
------
```
同步和异步任务分别进入不同的执行"场所"，同步的进入主线程，异步的进入 Event Table* 并注册函数。(先进入table再进入queue)
当指定的事情完成时，Event Table会将这个函数移入Event Queue*。
主线程内的任务执行完毕为空，会去Event Queue读取对应的函数，进入主线程执行。
上述过程会不断重复，也就是常说的Event Loop(事件循环)。
```

3、还有吗？
------
```
js一直在做一个工作，就是从任务队列里提取任务，放到主线程里执行。下面我们来进行更深一步的理解。
 
（1）所有同步任务都在主线程上执行，形成一个执行栈（execution context stack）。

（2）主线程之外，还存在一个"任务队列"（task queue）。只要异步任务有了运行结果，就在"任务队列"之中放置一个事件。

（3）一旦"执行栈"中的所有同步任务执行完毕，系统就会读取"任务队列"，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。

（4）主线程不断重复上面的第三步。
```

4、宏任务与微任务的优先级？
------
```
2.宏任务macrotask：

（事件队列中的每一个事件都是一个macrotask）

优先级：主代码块 > setImmediate > MessageChannel > setTimeout / setInterval

比如：setImmediate指定的回调函数，总是排在setTimeout前面

3.微任务优先级：process.nextTick > Promise > MutationObserver
```

async await                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         